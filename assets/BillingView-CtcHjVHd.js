import{a as c,h as u,i as X,j as Z,U as x,R as B,o as h,c as D,b as n,w as r,e as m,t as d,u as ee,G as ae,k as te,l as le,m as ne,n as ue,p,D as C,F as oe,q as se,L as t,s as F,v as re,x as ge,y as ie,z as ce,g as de,B as _e,C as fe,H as me,_ as pe}from"./index-DZ4REueG.js";const ve={style:{"margin-left":"5%","margin-right":"5%"}},w=3,S=2,be={__name:"Billing",props:{language:String,ruleset_id:String},setup(v){const e=v,b=c(!1),_=c({}),i=c([]),g=c(void 0),E=c(void 0),y=c(!1),N=c(0),V=u(()=>{if(e.language==t.CN)return"刷新数据";if(e.language==t.EN)return"Refresh"}),G=u(()=>{if(e.language==t.CN)return"统计范围";if(e.language==t.EN)return"Stats Range"}),P=u(()=>{if(e.language==t.CN)return"选手";if(e.language==t.EN)return"Player"}),L=u(()=>{if(e.language==t.CN)return"应付";if(e.language==t.EN)return"Payable"}),A=u(()=>{if(e.language==t.CN)return"八口场次";if(e.language==t.EN)return"AutoTable Games"}),k=u(()=>{if(e.language==t.CN)return"半庄收费";if(e.language==t.EN)return"Rate per Hanchan"}),U=u(()=>{if(e.language==t.CN)return"每月免费额度";if(e.language==t.EN)return"Free Games Per Month"}),q=u(()=>{if(e.language==t.CN)return"总应付";if(e.language==t.EN)return"Total Payable"}),H=u(()=>{if(e.language==t.CN)return"此规则没有配置后台数据库";if(e.language==t.EN)return"The Selected Ruleset Does Not Have Database"}),I=u(()=>{if(e.language==t.CN)return"只支持某一个月份计算";if(e.language==t.EN)return"Date Range Must Be In The Same Month"});u(()=>F[g.value]);function Y(a,l){return a.payable==0?"-":`$${a.payable}`}X(()=>{console.log("onBeforeMount called"),E.value=e.ruleset_id,g.value=e.ruleset_id}),Z(()=>{console.log("onMounted called"),b.value==!1&&(i.value=j(),b.value=!0),M()});function O(a,l,o){return console.log(`FetchLeaderBoard range: ${a} to ${l} player: ${o} ruleset_id: ${g.value}`),ee(`${ae}?action=get_stats&start_date=${a}&end_date=${l}&ruleset_id=${g.value}`).get().json().data}function M(){if(console.log("RefreshData"),!x.has(g.value)){alert(`${H.value}: ${B[g.value][e.language]}`);return}g.value=E.value;const a=i.value[0],l=i.value[1],o=a.getFullYear()*1e4+(a.getMonth()+1)*100+a.getDate(),f=l.getFullYear()*1e4+(l.getMonth()+1)*100+l.getDate();if(a.getFullYear()!=l.getFullYear()||a.getMonth()!=l.getMonth()){alert(`${I.value}`);return}y.value=!0,_.value=O(o,f),console.log("Getting stats=",_.value)}function j(){const a=new Date;return[new Date(a.getFullYear(),a.getMonth(),1),new Date(a.getFullYear(),a.getMonth()+1,0)]}const z=u(()=>{console.log("Generate ComputedLeaderBoard");let a=[];if(!_.value||!_.value.value||!(g.value in F))return a;N.value=0;for(const l of _.value.value.stats){const o={name:`${l.player_name}`,game_equipment_auto8_count:l.game_equipment_count_map[re.AUTO8]};o.payable=Math.max(0,o.game_equipment_auto8_count-w)*S,N.value+=o.payable,a.push(o)}return y.value=!1,a});return(a,l)=>{const o=ge,f=te,T=le,R=ie,Q=me,J=ce,K=de,$=_e,W=ne;return h(),D("div",null,[n(f,null,{default:r(()=>[n(o,null,{default:r(()=>[m(d(`${U.value}: ${w}`),1)]),_:1}),n(o,null,{default:r(()=>[m(d(`${k.value}: $${S}`),1)]),_:1})]),_:1}),n(T,null,{default:r(()=>[m(d(G.value),1)]),_:1}),n(f,{style:{"margin-bottom":"1%"}},{default:r(()=>[n(R,{modelValue:i.value[0],"onUpdate:modelValue":l[0]||(l[0]=s=>i.value[0]=s),type:"date",style:{width:"40%"}},null,8,["modelValue"]),ue("span",ve,d(p(C).TO[e.language]),1),n(R,{modelValue:i.value[1],"onUpdate:modelValue":l[1]||(l[1]=s=>i.value[1]=s),type:"date",style:{width:"40%"}},null,8,["modelValue"])]),_:1}),n(f,{style:{"margin-bottom":"1%"}},{default:r(()=>[n(J,{modelValue:E.value,"onUpdate:modelValue":l[2]||(l[2]=s=>E.value=s),filterable:"",style:{width:"40%"},placeholder:p(C).RULESET[e.language]},{default:r(()=>[(h(!0),D(oe,null,se(p(x),s=>(h(),fe(Q,{key:s,label:p(B)[s][v.language],value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),n(K,{type:"primary",disabled:y.value,onClick:M,style:{"margin-left":"5%"}},{default:r(()=>[m(d(y.value?p(C).LOADING[v.language]:V.value),1)]),_:1},8,["disabled"])]),_:1}),n(T),n(W,{data:z.value,style:{width:"100%"},stripe:"","table-layout":"auto"},{default:r(()=>[n($,{fixed:"",prop:"name",label:P.value},null,8,["label"]),n($,{prop:"game_equipment_auto8_count",label:A.value,sortable:""},null,8,["label"]),n($,{prop:"payable",label:L.value,formatter:Y,sortable:""},null,8,["label"])]),_:1},8,["data"]),n(T),m(" "+d(`${q.value}: $${N.value}`),1)])}}},Ee={};function ye(v,e){const b=be;return h(),D("main",null,[n(b,{language:"CHINESE",ruleset_id:"THE_3Q1_LEAGUE"})])}const Ne=pe(Ee,[["render",ye]]);export{Ne as default};
